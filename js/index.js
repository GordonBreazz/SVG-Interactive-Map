var idAarr = {
  "RU-MOW": {
    title: "Москва",
  },
  "RU-CHE": {
    title: "Челябинская область",
  },
  "RU-ORL": {
    title: "Орловская область",
  },
  "RU-OMS": {
    title: "Омская область",
  },
  "RU-LIP": {
    title: "Липецкая область",
  },
  "RU-KRS": {
    title: "Курская область",
  },
  "RU-RYA": {
    title: "Рязанская область",
  },
  "RU-BRY": {
    title: "Брянская область",
  },
  "RU-KIR": {
    title: "Кировская область",
  },
  "RU-ARK": {
    title: "Архангельская область",
  },
  "RU-MUR": {
    title: "Мурманская область",
  },
  "RU-SPE": {
    title: "Санкт-Петербург",
  },
  "RU-YAR": {
    title: "Ярославская область",
  },
  "RU-ULY": {
    title: "Ульяновская область",
  },
  "RU-NVS": {
    title: "Новосибирская область",
  },
  "RU-TYU": {
    title: "Тюменская область",
  },
  "RU-SVE": {
    title: "Свердловская область",
  },
  "RU-NGR": {
    title: "Новгородская область",
  },
  "RU-KGN": {
    title: "Курганская область",
  },
  "RU-KGD": {
    title: "Калининградская область",
  },
  "RU-IVA": {
    title: "Ивановская область",
  },
  "RU-AST": {
    title: "Астраханская область",
  },
  "RU-KHA": {
    title: "Хабаровский край",
  },
  "RU-CE": {
    title: "Чеченская республика",
  },
  "RU-UD": {
    title: "Удмуртская республика",
  },
  "RU-SE": {
    title: "Республика Северная Осетия",
  },
  "RU-MO": {
    title: "Республика Мордовия",
  },
  "RU-KR": {
    title: "Республика  Карелия",
  },
  "RU-KL": {
    title: "Республика  Калмыкия",
  },
  "RU-IN": {
    title: "Республика  Ингушетия",
  },
  "RU-AL": {
    title: "Республика Алтай",
  },
  "RU-BA": {
    title: "Республика Башкортостан",
  },
  "RU-AD": {
    title: "Республика Адыгея",
  },
  "RU-CR": {
    title: "Республика Крым",
  },
  "RU-SEV": {
    title: "Севастополь",
  },
  "RU-KO": {
    title: "Республика Коми",
  },
  "RU-PNZ": {
    title: "Пензенская область",
  },
  "RU-TAM": {
    title: "Тамбовская область",
  },
  "RU-LEN": {
    title: "Ленинградская область",
    info: "В XIX веке носит название - Санкт-Петербургская губерния",
    url: "https://ru.wikipedia.org/wiki/%D0%A1%D0%B0%D0%BD%D0%BA%D1%82-%D0%9F%D0%B5%D1%82%D0%B5%D1%80%D0%B1%D1%83%D1%80%D0%B3%D1%81%D0%BA%D0%B0%D1%8F_%D0%B3%D1%83%D0%B1%D0%B5%D1%80%D0%BD%D0%B8%D1%8F",
  },
  "RU-VLG": {
    title: "Вологодская область",
  },
  "RU-KOS": {
    title: "Костромская область",
  },
  "RU-PSK": {
    title: "Псковская область",
  },
  "RU-YAN": {
    title: "Ямало-Ненецкий АО",
  },
  "RU-CHU": {
    title: "Чукотский АО",
  },
  "RU-YEV": {
    title: "Еврейская автономская область",
  },
  "RU-TY": {
    title: "Республика Тыва",
  },
  "RU-SAK": {
    title: "Сахалинская область",
  },
  "RU-AMU": {
    title: "Амурская область",
  },
  "RU-BU": {
    title: "Республика Бурятия",
    info: "Во второй половине XIX века Бурятия называлась Верхнеудинским уездом (округом) и входила в состав Забайкальской области Российской империи.  До 1851 года являлась частью Иркутской губернии",
    url: "https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B1%D0%B0%D0%B9%D0%BA%D0%B0%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D0%BE%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C#%D0%98%D1%81%D1%82%D0%BE%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B0",
  },
  "RU-KK": {
    title: "Республика Хакасия",
  },
  "RU-KEM": {
    title: "Кемеровская область",
  },
  "RU-ALT": {
    title: "Алтайский край",
  },
  "RU-DA": {
    title: "Республика Дагестан",
  },
  "RU-KB": {
    title: "Кабардино-Балкарская республика",
  },
  "RU-KC": {
    title: "Карачаевая-Черкесская республика",
  },
  "RU-KDA": {
    title: "Краснодарский край",
  },
  "RU-ROS": {
    title: "Ростовская область",
  },
  "RU-SAM": {
    title: "Самарская область",
  },
  "RU-TA": {
    title: "Республика Татарстан",
    info: "В XIX веке носит название - Казанская губерния",
    url: "https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B1%D0%B0%D0%B9%D0%BA%D0%B0%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D0%BE%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C#%D0%98%D1%81%D1%82%D0%BE%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B0",
  },
  "RU-ME": {
    title: "Республика Марий Эл",
  },
  "RU-CU": {
    title: "Чувашская республика",
  },
  "RU-NIZ": {
    title: "Нижегородская край",
  },
  "RU-VLA": {
    title: "Владимировская область",
  },
  "RU-MOS": {
    title: "Московская область",
  },
  "RU-KLU": {
    title: "Калужская область",
  },
  "RU-BEL": {
    title: "Белгородская область",
  },
  "RU-ZAB": {
    title: "Забайкальский край",
    info: "Во второй половине XIX века -  Нерчинский уезд (округ) Забайкальской области Российской империи.  До 1851 года являлась частью Иркутской губернии",
    url: "https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B1%D0%B0%D0%B9%D0%BA%D0%B0%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D0%BE%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C#%D0%98%D1%81%D1%82%D0%BE%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B0",
  },
  "RU-PRI": {
    title: "Приморский край",
  },
  "RU-KAM": {
    title: "Камачатский край",
  },
  "RU-MAG": {
    title: "Магаданская область",
  },
  "RU-SA": {
    title: "Республика Саха",
  },
  "RU-KYA": {
    title: "Красноярский край",
  },
  "RU-ORE": {
    title: "Оренбургская область",
  },
  "RU-SAR": {
    title: "Саратовская область",
  },
  "RU-VGG": {
    title: "Волгоградская область",
  },
  "RU-VOR": {
    title: "Ставропольский край",
  },
  "RU-SMO": {
    title: "Смоленская область",
  },
  "RU-TVE": {
    title: "Тверская область",
  },
  "RU-PER": {
    title: "Пермская область",
  },
  "RU-KHM": {
    title: "Ханты-Мансийский АО",
  },
  "RU-KHM": {
    title: "Ханты-Мансийский АО",
  },
  "RU-TOM": {
    title: "Томская область",
  },
  "RU-IRK": {
    title: "Иркутская область",
    info: "В XIX веке носит название - Иркутская губерния. До 1851 года губерния включала в свой состав Забайкальскую область (современные Республику Бурятия и Забакальский край)",
    url: "https://ru.wikipedia.org/wiki/%D0%98%D1%80%D0%BA%D1%83%D1%82%D1%81%D0%BA%D0%B0%D1%8F_%D0%B3%D1%83%D0%B1%D0%B5%D1%80%D0%BD%D0%B8%D1%8F#%D0%98%D1%81%D1%82%D0%BE%D1%80%D0%B8%D1%8F",
  },
  "RU-NEN": {
    title: "Ненецскй АО",
  },
  "RU-STA": {
    title: "Ставропольский край",
  },
  "RU-TUL": {
    title: "Тульская область",
  },
}

var mapOptions = {
    events: {
      mouseWheel: false, // enables mouse wheel zooming events
      doubleClick: false, // enables double-click to zoom-in events
      drag: true, // enables drag and drop to move the SVG events
      dragCursor: "move", // cursor to use while dragging the SVG
    },
    animationTime: 300, // time in milliseconds to use as default for animations. Set 0 to remove the animation
    zoomFactor: 0.25, // how much to zoom-in or zoom-out
    maxZoom: 3, //maximum zoom in, must be a number bigger than 1
    panFactor: 100, // how much to move the viewBox when calling .panDirection() methods
    // initialViewBox: {
    //   // the initial viewBox, if null or undefined will try to use the viewBox set in the svg tag. Also accepts string in the format "X Y Width Height"
    //   x: 0, // the top-left corner X coordinate
    //   y: 0, // the top-left corner Y coordinate
    //   width: 1000, // the width of the viewBox
    //   height: 1000 // the height of the viewBox
    // },
    // limits: {
    //   // the limits in which the image can be moved. If null or undefined will use the initialViewBox plus 15% in each direction
    //   x: -150,
    //   y: -150,
    //   x2: 1150,
    //   y2: 1150
    // }
  },
  svgPanZoom,
  currentZoom = 0,
  zoomFactor = 4,
  iframeTarget = "ifrm",
  localCursor,
  currentCityId = null,
  lastAreaId = null,
  mapBacklightColor = "#f5d78c", //"#00fff8",//"#00d7ff"//"#00ff82",
  mapHoverRegionColor = "#f6e72d",
  mapBackgroundColor = "rgba(0,0,0,0.2)",
  areaList = [],
  countdown,
  countdown1,
  mapMarkerColor = {
    normal: "red",
    active: "blue",
    fill: "transparent",
    opacity: 1,
    lineColor: "orange",
    lineOpacity: 1,
  },
  mapMarkerNormal = {
    normal: 3,
    active: 8,
    strokeNormal: 2,
    strokeActive: 3.5,
    lineStrokeWidth: 4,
    lineStrokeDasharray: "10",
    activeClss: "active-point",
  },
  mapMarkerInZoom = {
    normal: 1.5,
    active: 3,
    strokeNormal: 1,
    strokeActive: 1.5,
    lineStrokeWidth: "1.5",
    lineStrokeDasharray: 6,
    activeClss: "active-point-zoom",
  },
  lastCityPoint = {
    id: "",
  },
  indicatorWindow = {
    show: false,
    isDelay: false,
    position: {
      x: 0,
      y: 0,
    },
    offset: {
      x: 20,
      y: 20,
      width: 0,
      height: 0,
    },
  },
  cityPoints = [
    {
      id: "ulanude",
      name: "г. Улан-Удэ",
      date: "Настоящее время",
      title: "г. Верхнеудинск",
      info: "Улан-Удэ столица Республики Бурятия особо чтит первого бурятского учёного. В городе Доржи Базарову установлены памятники, его наследие и труды бережно сохранены для будущих поколений.  Именно отсюда мы начнём путешествие по жизненному пути нашего  земляка",
      url: "https://cdn.knightlab.com/libs/storymapjs/latest/embed/?url=//uploads.knightlab.com/storymapjs/c6722dcf1316d3ff987d2901d84685d2/gordon/published.json",
      cx: 610,
      cy: 480,
      next: ["dodo"],
      zoom: true,
      area: "RU-BU",
    },
    {
      id: "dodo",
      name: "улус Додо-Ичётуй",
      title: "улус Кутетуевский",
      date: "1822 год",
      info: "Место рождения Доржи Банзарова",
      url: "https://cdn.knightlab.com/libs/storymapjs/latest/embed/?url=//uploads.knightlab.com/storymapjs/c6722dcf1316d3ff987d2901d84685d2/gordon/published.json&start_at_slide=2",
      cx: 575,
      cy: 505,
      next: ["haracai"],
      zoom: true,
      area: "RU-BU",
    },
    {
      id: "haracai",
      name: "улус Харацай",
      title: "станица Атамано-Николаевская",
      date: "1830 - 1833 год",
      info: "учёба в Атамано-Николаевское училище",
      url: "https://cdn.knightlab.com/libs/storymapjs/latest/embed/?url=//uploads.knightlab.com/storymapjs/c6722dcf1316d3ff987d2901d84685d2/gordon/published.json&start_at_slide=3",
      cx: 565,
      cy: 500,
      next: ["kyahta"],
      zoom: true,
      area: "RU-BU",
    },
    {
      id: "kyahta",
      name: "г. Кяхта",
      title: "г. Троицкосавск",
      date: "1833 - 1836 год",
      info: "Военное училище ",
      url: "https://cdn.knightlab.com/libs/storymapjs/latest/embed/?url=//uploads.knightlab.com/storymapjs/c6722dcf1316d3ff987d2901d84685d2/gordon/published.json&start_at_slide=4",
      cx: 585,
      cy: 515,
      next: ["kazan"],
      zoom: false,
      area: "RU-BU",
    },
    {
      id: "kazan",
      name: "г. Казань",
      title: null,
      date: "1836 - 1846 год",
      info: "Студенческие годы ",
      url: "https://cdn.knightlab.com/libs/storymapjs/latest/embed/?url=//uploads.knightlab.com/storymapjs/c6722dcf1316d3ff987d2901d84685d2/gordon/published.json&start_at_slide=5",
      cx: 200,
      cy: 330,
      next: ["piter", "irkutsk"],
      zoom: false,
      area: "RU-TA",
    },
    {
      id: "piter",
      name: "г. Санкт-Петербург",
      title: null,
      date: "1847 - 1849 год",
      info: "Научная работа",
      url: "https://cdn.knightlab.com/libs/storymapjs/latest/embed/?url=//uploads.knightlab.com/storymapjs/c6722dcf1316d3ff987d2901d84685d2/gordon/published.json&start_at_slide=5",
      cx: 133,
      cy: 185,
      next: ["kazan"],
      zoom: false,
      area: "RU-LEN",
    },
    {
      id: "irkutsk",
      name: "г. Иркутск",
      title: null,
      date: "1850 - 1855 год",
      info: "чиновник по особым поручениям",
      url: "https://cdn.knightlab.com/libs/storymapjs/latest/embed/?url=//uploads.knightlab.com/storymapjs/c6722dcf1316d3ff987d2901d84685d2/gordon/published.json&start_at_slide=5",
      cx: 568,
      cy: 487,
      next: null,
      zoom: false,
      area: "RU-IRK",
    },
  ]

$("path").mousemove(function (e) {
  indicatorWindow.position.x = e.pageX
  indicatorWindow.position.y = e.pageY
})

function showAreaInfo(area) {
  var txt = `<h4>${area.title}</h4>`
  if (area.info) txt += `<p>${area.info}</p>`
  if (area.url)
    txt += `<div style="width: 100%; text-align: right"><a class="button-62" role="button" href="${area.url}" target="_blank">Подробнее..</a></div>`
  showIndicator(txt, indicatorWindow.position.x, indicatorWindow.position.y)
}

$("path").hover(
  function (e) {
    // $('path').css('fill', '#fff')
    if (!indicatorWindow.isDelay) hideIndicator()
    else {
      clearTimeout(countdown1)
      countdown1 = setTimeout(function () {
        indicatorWindow.isDelay = false
      }, 500)
      return false
    }
    var id = $(this).attr("id").toUpperCase()
    clearTimeout(countdown)
    if (idAarr[id]) {
      lastAreaId = id 
      countdown = setTimeout(function () {
        showAreaInfo(idAarr[id])
      }, 1000)
    }

    // if ($(this).attr("flag")) {
    //   var flag = "assets/images/" + $(this).attr("flag")
    //   console.log(flag)
    //   $(' <img class="flag" src="" alt="">').appendTo(".indicator")
    //   $(".indicator").find("img").attr("src", flag)
    //   // $('<img src='+ flag+ ' >').appendTo('.indicator');
    // }

    // $('.change').remove()

    // var script = document.createElement("script")
    // // script.classList.add('change');
    // //script.src = 'http://api.geonames.org/countryInfoJSON?country='+info[id]+'&username=pixeltest&style=full&callback=update';
    // document.body.appendChild(script)

    $(this).css("fill", mapHoverRegionColor)
    // $('path')
    //   .not(this)
    //   .css('fill', mapBackgroundColor)
  },
  function () {
    //hideIndicator()
    // if (lastCi tyPoint)
    //   if (lastCityPoint.area !=  $(this).attr('id').toUpperCase()) console.log('okkkkkkkkkkkkk',lastCityPoint.area, $(this).attr('id').toUpperCase()
    $("path").css("fill", mapBackgroundColor)
    areaHighlight()
  }
)

function showIndicator(htmlText, x, y, isDelay = false) {
  indicatorWindow.isDelay = isDelay
  if (indicatorWindow.show) hideIndicator()
  clearTimeout(countdown)
  $("<div>" + htmlText + "</div>").appendTo(".indicator")
  $(".indicator")
    .css({
      top: y + indicatorWindow.offset.height, //indicatorWindow.offset.y,
      left: x + indicatorWindow.offset.width, //indicatorWindow.offset.x,
    })
    .show()
  indicatorWindow.show = true
}

function hideIndicator() {
  if (indicatorWindow.show == false) return false

  indicatorWindow.show = false
  $(".indicator").html("")
  $(".indicator").hide()
}

$("path").each(function () {
  var regId = $(this).attr("id")
  var flag = ""
  var name = idAarr[regId].title
  $(this).attr("name", name)
  // for (var j = 0; j < idAarr2.length; j++) {
  //   if (regId == idAarr2[j][0]) {
  //     name = idAarr2[j][1]
  //     flag = "flags/" + idAarr2[j][2]

  //     $(this).attr("name", name)
  //     $(this).attr("flag", flag)
  //   }
  // }

  // var regIdDiv =
  //   '<div class="reg" >' +
  //   "[" +
  //   "<span>" +
  //   regId +
  //   "</span>" +
  //   "]" +
  //   " " +
  //   name +
  //   "</div>"
  // $(regIdDiv).appendTo(".regs")

  // var idArrMin = [regId, '_'];
  // idAarr2.push(idArrMin);
})

function getCityPoint(id) {
  return cityPoints.find(function (elem) {
    if (elem.id == id) return elem
  })
}

function setAriasList(id) {
  let city = getCityPoint(id)
  areaList = [city.area]
  for (let item of city.next) {
    let nexCity = getCityPoint(item)
    areaList.push(nexCity.area)
  }
  areaHighlight()
  return areaList
}

function areaHighlight(color = mapBacklightColor) {
  for (let id of areaList) $("#" + id).css("fill", color)
}

function showCityPointInfo(id) {
  //if (indicatorWindow.show) return false
  var elem = document.getElementById(id),
    rect = elem.getBoundingClientRect()
  indicatorWindow.offset.width = rect.width
  indicatorWindow.offset.height = rect.height
  var city = getCityPoint(id)
  if (city) {
    var thtml = ''
    if  (city.date) thtml += `<h3>${city.date}</h3>`
    thtml += `<h4>Место: ${city.name}</h4>`
    if (city.title) thtml += `<p>Название в XIX веке: ${city.title}</p>`
    if (city.info) thtml += `<p>${city.info}</p>`
    if (city.url)
      thtml += `<div style="width: 100%; text-align: right"><a class="button-62" role="button" href="${city.url}" target="${iframeTarget}">Подробнее..</a></div>`
    showIndicator(thtml, rect.x, rect.y, true)
  }
}

function cityMarkerActivate(id, m) {
  if (currentCityId != lastCityPoint) {
    $("#" + id).attr("r", m.active)
    $("#" + id).attr("stroke-width", m.strokeActive)
    showCityPointInfo(id)
  }
}

function cityMarkerDeactivate(id, e, m) {
  var city = getCityPoint(id)
  if (city) {
    //areaHighlight(city.area, mapBackgroundColor)
  }
  if (currentCityId != id) {
    $("#" + id).attr("r", m.normal)
    $("#" + id).attr("stroke-width", m.strokeNormal)
  }
}

function pointHighlighter() {
  var m = mapMarkerInZoom
  if (currentZoom == 0) m = mapMarkerNormal

  if (currentCityId) {
    $("#" + currentCityId).attr("r", m.active)
    $("#" + currentCityId).attr("stroke-width", m.strokeActive)
  }

  if (lastCityPoint.id && lastCityPoint.id != currentCityId) {
    $("#" + lastCityPoint.id).attr("r", m.normal)
    $("#" + lastCityPoint.id).attr("stroke-width", m.strokeNormal)
  }
  hideIndicator()
}

function changeMapMarkers(m, cls = ".circle5") {
  $(cls).attr("r", m.normal)
  $(cls).attr("stroke-width", m.strokeNormal)
  pointHighlighter(m)

  $(cls).hover(
    function (e) {
      cityMarkerActivate($(this).attr("id"), m)
    },
    function (e) {
      cityMarkerDeactivate($(this).attr("id"), e, m)
    }
  )
  $(".path5").attr("stroke-width", m.lineStrokeWidth)
  $(".path5").attr("stroke-dasharray", m.lineStrokeDasharray)
}
/////////////////////////////////////////// Map Initialization
function initMap() {
  $.each(cityPoints, function (index, val) {
    nextList = val.next
    var svg = document.getElementById("svg2")

    if (nextList)
      $.each(nextList, function (ind, v) {
        var city = getCityPoint(v)
        svg.insertAdjacentHTML(
          "beforeend",
          `<line id="${val.id + "_" + v}" class="path5" x2="${city.cx}" x1="${
            val.cx
          }" y2="${city.cy}" y1="${val.cy}" stroke="${
            mapMarkerColor.lineColor
          }" opacity="${mapMarkerColor.lineOpacity}" fill="transparent"
      stroke-width="5" stroke-dasharray="10 5" visibility="hidden" stroke-linecap="round" />`
        )
      })
  })

  // Insert Cities
  $.each(cityPoints, function (index, val) {
    var svg = document.getElementById("svg2")
    svg.insertAdjacentHTML(
      "beforeend",
      `<circle class="circle5" id="${val.id}" cx="${val.cx}" cy="${val.cy}" r="3" stroke="${mapMarkerColor.normal}" fill="${mapMarkerColor.fill}" stroke-width="3" stroke-opacity="${mapMarkerColor.opacity}" />`
    )
  })

  changeMapMarkers(mapMarkerNormal)
  $(".circle5").click(clickByPoint)

  $("#svg2").click(function () {
    if (indicatorWindow.show) hideIndicator()
      else showAreaInfo(idAarr[lastAreaId])
  })

  $("#svg2").dblclick(function () {
    zoom(0)
  })
  svgPanZoom = $("#svg2").svgPanZoom(mapOptions)
  $("path").css("fill", mapBackgroundColor)
}

function zoom(newZoomVal = 0) {
  if (newZoomVal < 0) return false
  if (newZoomVal > currentZoom) {
    currentZoom = newZoomVal
    svgPanZoom.zoomIn(currentZoom)
    changeMapMarkers(mapMarkerInZoom)
    return true
  }
  if (newZoomVal < currentZoom) {
    svgPanZoom.zoomOut(currentZoom - newZoomVal)
    currentZoom = newZoomVal
    pointHighlighter()
    changeMapMarkers(mapMarkerNormal)
    $("#" + currentCityId).removeClass(mapMarkerInZoom.activeClss)
    $("#" + currentCityId).addClass(mapMarkerNormal.activeClss)

    return true
  }
  return false
}

function drawLine(sId, fId) {
  $("#" + sId + "_" + fId).attr("visibility", "visibility")
  getCityPoint(sId).area
  areaList = [...areaList, getCityPoint(sId).area, getCityPoint(fId).area]
  areaHighlight()
}
//==============================================================
function clickByPoint(event) {
  var m1,
    city = getCityPoint(event.currentTarget.id)
  indicatorWindow.isDelay = false
  areaList = [city.area]
  if (city.zoom) m1 = mapMarkerInZoom
  else m1 = mapMarkerNormal
  if (currentCityId) {
    $("#" + currentCityId).attr("stroke", mapMarkerColor.normal)
    $("#" + currentCityId).removeClass(mapMarkerNormal.activeClss)
    $("#" + currentCityId).removeClass(mapMarkerInZoom.activeClss)
  }
  currentCityId = city.id
  $("#" + currentCityId).attr("stroke", mapMarkerColor.active)
  $("#" + currentCityId).addClass(m1.activeClss)

  //draw lines between points
  $(".path5").attr("visibility", "hidden")
  if (city.next) {
    if (city.id == "kazan" && lastCityPoint.id == "kyahta")
      drawLine(currentCityId, city.next[0])
    else if (city.id == "kazan" && lastCityPoint.id == "piter")
      drawLine(currentCityId, city.next[1])
    else for (var item of city.next) drawLine(currentCityId, item)
  }

  if (city.zoom && currentZoom == 0) {
    zoom(zoomFactor)
    //  svgPanZoom.setCenter(city.cx, city.cy)
  }

  if (!city.zoom && currentZoom > 0) {
    zoom(0)
  }
  svgPanZoom.setCenter(city.cx, city.cy)
  pointHighlighter()
  setTimeout(function () {
    showCityPointInfo(currentCityId)
  }, 300)
  //
  lastCityPoint = city
}

$(document).ready(function () {
  initMap()
})
